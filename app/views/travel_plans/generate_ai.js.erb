<%# app/views/travel_plans/generate_ai.js.erb %>

<% if @ai_plans.blank? %>
  document.getElementById('ai-response-area').innerHTML = `
    <div class="ai-error-container">
      <h2 class="ai-title">プラン生成に失敗しました</h2>
      <p class="ai-placeholder">
        AIによるプラン生成中にエラーが発生しました。<br>
        時間を置いて再度お試しください。
      </p>
    </div>
  `;
<% else %>
  document.getElementById('ai-response-area').innerHTML = `
    <h2 class="ai-title">AIの旅行プラン提案</h2>
    <div class="ai-plans-container">
      <% @ai_plans.each_with_index do |plan, index| %>
        <div class="ai-plan-card">
          <div class="card-header">
            <h3 class="plan-name"><%= plan["plan_name"] || "提案プラン#{index + 1}" %></h3>
            <% if plan["itinerary"] %>
              <span class="plan-days"><%= plan["itinerary"].length %>日間</span>
            <% end %>
          </div>
          <div class="card-body">
            <%# ここを修正します %>
            <p><strong>行き先:</strong> <%= plan["itinerary"].map { |day| day["place"] }.compact.join('、') %></p>
            <p><strong>期間:</strong> <%= plan["itinerary"].first["date"] rescue "" %> 〜 <%= plan["itinerary"].last["date"] rescue "" %></p>
            <p><strong>総予算:</strong> <%= params.dig(:travel_plan, :budget) %>円</p>
            <p><strong>概要:</strong> <%= plan["itinerary"].first["morning_activity"] rescue "" %> など</p>
          </div>
          <div class="card-footer">
            <a href="/travel_plans/preview?plan_index=<%= index %>" class="select-plan-button">詳細を見る</a>
          </div>
        </div>
      <% end %>
    </div>
  `;
<% end %>