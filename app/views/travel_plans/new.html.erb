<%= render 'shared/header' %>

<div class="split-screen-container">
  <div class="split-panel left-panel">
    <div class="ai-response-area" id="ai-response-area">
      <h2 class="ai-title">AIプランニング</h2>
      <p class="ai-placeholder">
        条件を入力して、AIに旅行プランを作成してもらいましょう。<br>
        ここにAIが生成した旅行プランが表示されます。
      </p>
    </div>
  </div>

  <div class="split-panel right-panel">
    <div class="form-card">
      <h2 class="form-title">旅行の条件を入力</h2>

      <%= form_with(
            model: @travel_plan,
            url: generate_ai_travel_plans_path,
            method: :post,
            data: { turbo: false, remote: true },  # Turbo無効化 + remote true
            html: { id: "ai-form" }
          ) do |f| %>

        <div class="field">
          <%= f.label :name, "プラン名" %><br />
          <%= f.text_field :name, class: "form-input", placeholder: "例：京都の紅葉を満喫する旅" %>
        </div>

        <div class="field">
          <%= f.label :destination_ids, "行き先（複数選択可）" %><br />

           <!-- 地方の選択 -->
          <select data-group-select class="form-input">
            <option value="">地方を選択してください</option>
            <% @prefecture_groups.each do |group| %>
              <option value="<%= group.id %>"><%= group.name %></option>
            <% end %>
          </select>

          <!-- 都道府県のチェックボックス -->
          <div id="destination-checkboxes">
            <% @destinations.each do |destination| %>
              <div data-prefecture-group="<%= destination.prefecture_group_id %>">
                <%= f.check_box :destination_ids, { multiple: true }, destination.id, nil %>
                <%= destination.name %>
              </div>
            <% end %>
          </div>
        </div>

        <div class="field">
          <%= f.label :start_date, "開始日" %><br />
          <%= f.date_field :start_date, class: "form-input" %>
        </div>

        <div class="field">
          <%= f.label :end_date, "終了日" %><br />
          <%= f.date_field :end_date, class: "form-input" %>
        </div>

        <div class="field">
          <%= f.label :budget, "予算（目安）" %><br />
          <%= f.number_field :budget, class: "form-input", placeholder: "例：50000" %>
        </div>

        <div class="field">
          <%= f.label :notes, "その他ニーズ（AIに伝えたいこと）" %><br />
          <%= f.text_area :notes, class: "form-textarea", placeholder: "例：温泉宿に泊まりたい、歴史的な場所を巡りたい" %>
        </div>

        <div class="actions">
          <%= f.submit "AIにプランを作成してもらう", class: "form-submit-button" %>
        </div>

      <% end %>
    </div>
  </div>
</div>

<!-- ▼▼▼ デバッグ: 後で必ず削除してください ▼▼▼ -->
<div style="display:none" id="debug-data">
  groups=<%= PrefectureGroup.count %>,
  dests=<%= Destination.count %>,
  with_group=<%= Destination.where.not(prefecture_group_id: nil).count %>
</div>

<ul style="display:none">
  <% Destination.limit(5).each do |d| %>
    <li><%= "#{d.name} (group_id=#{d.prefecture_group_id})" %></li>
  <% end %>
</ul>
<!-- ▲▲▲ デバッグ: 後で必ず削除してください ▲▲▲ -->