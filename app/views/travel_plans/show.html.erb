<%# app/views/travel_plans/show.html.erb %>
<% content_for :head do %>
  <%= stylesheet_link_tag "travel_plans/show", media: "all", "data-turbo-track": "reload" %>
<% end %>

<div class="travel-plans-show">
<div class="page-container">
  <header class="plan-header">
    <div class="plan-header-left">
      <h2 class="plan-title"><%= (@travel_plan.name.presence || "旅行プラン").to_s %></h2>
      <div class="plan-meta">
        <span class="meta-badge">
          <%= @travel_plan.start_date&.to_s || "-" %> 〜 <%= @travel_plan.end_date&.to_s || "-" %>
        </span>
        <% if @travel_plan.destinations.loaded? || @travel_plan.respond_to?(:destinations) %>
          <% places = @travel_plan.destinations.map(&:name).uniq.join("・") %>
          <% if places.present? %>
            <span class="meta-badge meta-place"><%= places %></span>
          <% end %>
        <% end %>
        <% if @travel_plan.travel_purpose&.name.present? %>
          <span class="meta-badge meta-purpose"><%= @travel_plan.travel_purpose.name %></span>
        <% end %>
      </div>
    </div>

    <div class="plan-header-right">
      <%= link_to "プランを編集", edit_travel_plan_path(@travel_plan), class: "edit-plan-button" %>
      <%= link_to "プランを削除", @travel_plan, method: :delete,
          data: { confirm: "本当にこのプランを削除しますか？" },
          class: "delete-plan-button" %>
    </div>
  </header>

  <% if @travel_plan.itinerary.present? %>
    <section class="itinerary-container">
      <% @travel_plan.itinerary.each do |day| %>
        <article class="itinerary-day-card">
          <h3 class="day-title">
            Day <%= (day["day"] || "-").to_s %>：<%= (day["date"] || "").to_s %>
          </h3>

          <ul class="activity-list">
            <li>
              <span class="activity-label">場所</span>
              <span class="activity-body"><%= (day["place"].presence || "（未設定）").to_s %></span>
            </li>

            <li>
              <span class="activity-label">朝食</span>
              <span class="activity-body">
                <%= (day["breakfast_restaurant"].presence || "（未設定）").to_s %>
                <% if day["breakfast_restaurant_url"].present? %>
                  <%= link_to "予約", day["breakfast_restaurant_url"], target: "_blank", rel: "noopener", class: "reservation-link" %>
                <% end %>
              </span>
            </li>

            <li>
              <span class="activity-label">午前</span>
              <span class="activity-body"><%= (day["morning_activity"].presence || "（未設定）").to_s %></span>
            </li>

            <li>
              <span class="activity-label">昼食</span>
              <span class="activity-body">
                <%= (day["lunch_restaurant"].presence || "（未設定）").to_s %>
                <% if day["lunch_restaurant_url"].present? %>
                  <%= link_to "予約", day["lunch_restaurant_url"], target: "_blank", rel: "noopener", class: "reservation-link" %>
                <% end %>
              </span>
            </li>

            <li>
              <span class="activity-label">午後</span>
              <span class="activity-body"><%= (day["afternoon_activity"].presence || "（未設定）").to_s %></span>
            </li>

            <li>
              <span class="activity-label">夕食</span>
              <span class="activity-body">
                <%= (day["dinner_restaurant"].presence || "（未設定）").to_s %>
                <% if day["dinner_restaurant_url"].present? %>
                  <%= link_to "予約", day["dinner_restaurant_url"], target: "_blank", rel: "noopener", class: "reservation-link" %>
                <% end %>
              </span>
            </li>

            <li>
              <span class="activity-label">宿泊</span>
              <span class="activity-body">
                <%= (day["stay_hotel"].presence || "（未設定）").to_s %>
                <% if day["stay_hotel_url"].present? %>
                  <%= link_to "予約", day["stay_hotel_url"], target: "_blank", rel: "noopener", class: "reservation-link" %>
                <% end %>
              </span>
            </li>
          </ul>
        </article>
      <% end %>
    </section>
  <% else %>
    <div class="empty-state">
      <p>旅程データがありません。</p>
      <%= link_to "条件入力からAIプランを作成", new_travel_plan_path, class: "primary-cta" %>
    </div>
  <% end %>
</div>
</div>
